---
name: DeleteWorkflow

on:
  workflow_call:
    inputs:
      REPO:
        required: true
        type: string

jobs:
  DeleteWorkflow:
    name: DeleteWorkflow
    runs-on: ubuntu-22.04 # ubuntu-latest
    steps:
      - name: Show linters config
        run: |
          ls -alih "${GITHUB_WORKSPACE}/repository/.github/linters"
          OWNER="dennykorsukewitz"
          REPO="DK4"
          WORKFLOW="My Workflow"

          # gh run list --repo $OWNER/$REPO

          # gh run list --repo $OWNER/$REPO --workflow 'GitHub Pages 2'


          # list workflows
          WORKFLOW_IDS=($(gh api repos/$OWNER/$REPO/actions/workflows | jq '.workflows[] | .id')) && echo $WORKFLOW_IDS

          for WORKFLOW_ID in "${WORKFLOW_IDS[@]}"
          do
           echo "Listing runs for the workflow ID $WORKFLOW_ID"
           run_ids=( $(gh api repos/$OWNER/$REPO/actions/workflows/$WORKFLOW_ID/runs --paginate | jq '.workflow_runs[].id') )
           for run_id in "${run_ids[@]}"
           do
             echo "Deleting Run ID $run_id"
             gh api repos/$OWNER/$REPO/actions/runs/$run_id -X DELETE >/dev/null
           done
          done
